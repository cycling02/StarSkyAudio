## 完整单元测试计划

### 1. 模型层测试
创建 `model/` 测试目录，测试：
- **AudioInfoTest.kt**
  - 测试 AudioInfo 数据类创建
  - 测试 AudioInfo.create() 工厂方法
  - 测试序列化和反序列化

- **PlayModeTest.kt**
  - 测试所有枚举值（LOOP, SINGLE_LOOP, SHUFFLE）
  - 测试枚举名称

- **PlaybackStateTest.kt**
  - 测试所有状态对象（Idle, Buffering, Playing, Paused, Stopped, Completed）
  - 测试 Error 状态
  - 测试 Int.toPlaybackState() 扩展函数的各种情况

### 2. 持久化层测试
创建 `preferences/` 测试目录，测试：
- **StarSkyPreferencesManagerTest.kt**
  - 测试保存和读取当前音频信息
  - 测试保存和读取播放位置
  - 测试保存和读取播放模式
  - 测试保存和读取音量
  - 测试保存和读取播放速度
  - 测试保存和读取播放列表（JSON 序列化）
  - 测试保存和读取当前索引
  - 测试清除所有数据
  - 测试默认值

### 3. 缓存层测试
创建 `cache/` 测试目录，测试：
- **StarSkyCacheManagerTest.kt**
  - 测试单例模式
  - 测试缓存目录创建
  - 测试缓存大小限制
  - 测试缓存清理
  - 测试缓存数据源工厂创建

### 4. 播放器核心测试
创建 `player/` 测试目录，测试：
- **StarSkyPlayerTest.kt**
  - 测试播放单首音频
  - 测试播放播放列表
  - 测试播放/暂停/停止
  - 测试跳转功能
  - 测试上一首/下一首
  - 测试播放模式设置
  - 测试音量控制（边界值）
  - 测试速度控制（边界值）
  - 测试 StateFlow 状态变化
  - 测试监听器添加和移除

### 5. 主入口测试
创建 `StarSkyTest.kt`，测试：
- **StarSkyTest.kt**
  - 测试初始化
  - 测试单例模式
  - 测试所有播放控制方法的调用
  - 测试所有状态获取
  - 测试监听器管理
  - 测试通知功能
  - 测试缓存管理
  - 测试持久化功能（恢复和清除）

### 6. 测试工具类
创建 `utils/` 测试目录（如需要）：
- 可能的扩展函数测试
- 工具方法测试

### 测试框架
- 使用 JUnit 4
- 使用 MockKotlin 或 Mockito 进行模拟
- 测试覆盖率目标：80% 以上
- 添加必要的测试依赖（MockKotlin, Robolectric 等）